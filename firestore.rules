rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Permite que um usuário crie, leia e atualize seu próprio documento de usuário.
    // Isso é essencial para o fluxo de cadastro inicial.
    match /users/{userId} {
      allow read, update, create: if request.auth != null && request.auth.uid == userId;
    }

    // Permite que usuários acessem e modifiquem apenas as sub-coleções dentro de seus próprios dados
    // (ex: lançamentos, perfil, metas).
    match /users/{userId}/{documents=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
